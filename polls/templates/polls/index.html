
  {% load static %}<!doctype html>
<html>

<head>
    <title>Line Chart</title>



    <script src={% static 'js/jquery.js' %}></script>
    <script src={% static 'js/utils.js' %}></script>

    <script src={% static 'js/bootstrap.min.js' %}></script>

    <script src={% static 'js/Chart.min.js' %}></script>
    <link rel="stylesheet" href={% static 'css/bootstrap.min.css' %}>
    <link rel="stylesheet" href={% static 'css/animate.css' %}>
    <style>
    canvas{
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
    nav{
          box-shadow: 0 10px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19) !important;
      text-align: center;
      background: #FC466B;  /* fallback for old browsers */
background: -webkit-linear-gradient(to right, #3F5EFB, #FC466B);  /* Chrome 10-25, Safari 5.1-6 */
background: linear-gradient(to right, #3F5EFB, #FC466B); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */

    }
    ul{
      list-style: none;
      display: inline-flex;
      margin-bottom: 0;

    }
    li{

      padding: 10px;
    }
    #juan{

    }
    a{
      user-select: none;
      color: white;
      font-family: chaparral-pro,sans-serif;
      font-size: 15px;
    }
    a:hover{
      color: white;
      text-decoration: none;
      cursor: pointer;
    }
    .button {
      background: #000428;  /* fallback for old browsers */
    background: -webkit-linear-gradient(to right, #004e92, #000428);  /* Chrome 10-25, Safari 5.1-6 */
    background: linear-gradient(to right, #004e92, #000428); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        border-radius: 1px;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 12px;
        margin: 4px 2px;
        cursor: pointer;
    }
    .sidenav {
        height: 100%;
        width: 0;
        position: fixed;
        z-index: 1;
        top: 0;
        left: 0;
        background-color: #111;
        overflow-x: hidden;
        transition: 0.5s;
        padding-top: 60px;
    }

    .sidenav a {
        padding: 8px 8px 8px 32px;
        text-decoration: none;
        font-size: 25px;
        color: #818181;
        display: block;
        transition: 0.3s;
    }

    .sidenav a:hover {
        color: #f1f1f1;
    }

    .sidenav .closebtn {
        position: absolute;
        top: 0;
        right: 25px;
        font-size: 36px;
        margin-left: 50px;
    }

    @media screen and (max-height: 450px) {
      .sidenav {padding-top: 15px;}
      .sidenav a {font-size: 18px;}
    }

    </style>
</head>

<body>
  <nav>
  <ul>
  <a><li class="bounce" id="juan">Home</li></a>
  <a><li id="juan">Contact</li></a>
  <a><li id="juan">Test</li></a>
  <a><li id="juan">About</li></a>

</ul>
</nav>

    <div id="mySidenav" class="sidenav">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <a href="#">About</a>
      <a href="#">Services</a>
      <a href="#">Clients</a>
      <a href="#">Contact</a>
    </div>
    <div style="width:50%;margin-left: 25%;" >

        <canvas id="canvas" ></canvas>

    </div>
    <br>
    <br>
    <div align="center">

      <button id="activate" class="button">Track Live</button>
      <button id="deactivate" class="button">Stop Tracking</button>
      <button class="button" style="cursor:pointer" onclick="openNav()">Pick Coin</button
    </div>



    <script>

    //document.getElementById("activate")
    function openNav() {
    document.getElementById("mySidenav").style.width = "100%";
}

function closeNav() {
    document.getElementById("mySidenav").style.width = "0";
}
    async function getTrxValue(){
      try{
        var getData = await fetch('getPrice');
        const pyData = await getData.text();
        console.log("Data from python: " + pyData)
        return pyData;
      }catch (error){
        console.log(error);
      }
    }

        var MONTHS = ["1 SEC"];
        var config = {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: "$TRX VALUE",
                    backgroundColor: window.chartColors.blue,
                    borderColor: window.chartColors.black,
                    data: [

                    ],
                    fill: true,
                }],
            },
            options: {
                responsive: true,
                title:{
                    display:true,
                },
                tooltips: {
                    mode: 'index',
                    intersect: false,
                },
                hover: {
                    mode: 'nearest',
                    intersect: true
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'LIVE TIME'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: '$TRX'
                        }
                    }]
                }
            }
        };

        window.onload = function() {
            var ctx = document.getElementById("canvas").getContext("2d");
            window.myLine = new Chart(ctx, config);
        };

        var colorNames = Object.keys(window.chartColors);


        document.getElementById('activate').addEventListener('click', function (e){   //Get coin data periodically
          document.getElementById('activate').classList.remove("rollIn");
                    var bounce = setTimeout(document.getElementById('activate').classList.add("hinge", "animated"));
                    var activate = setTimeout(async function number(){
                    var data = await getTrxValue();
                    document.getElementById('activate').disabled = true;
                    if (config.data.datasets.length > 0) {
                        var month = MONTHS[config.data.labels.length % MONTHS.length];
                        var d = new Date();
                        var time = String(d.getHours()) + ":" + String(d.getMinutes()) + ":" + String(d.getSeconds());
                        config.data.labels.push(time);

                        config.data.datasets.forEach(function(dataset) {
                            if(dataset.data.length > 22){
                              console.log("Activated!");
                              config.data.labels.shift();
                              config.data.datasets[0].data.shift();
                              window.myLine.update();
                            }
                            dataset.data.push(data);
                        });
                        window.myLine.update();
                    }

                      var repeat = setTimeout(number, 3000);

                      document.getElementById('deactivate').addEventListener('click', function(){  //Stop getting coin data periodically
                        var bounce = setTimeout(document.getElementById('activate').classList.add("rollIn", "animated"));
                        document.getElementById('activate').disabled = false;
                        document.getElementById('activate').style.display = "";
                          clearTimeout(repeat);
                      });
                  });
                  var remove = setTimeout(bounce, 1000);
                  setTimeout(function(){
                    document.getElementById('activate').style.display = "None";
                    document.getElementById('activate').classList.remove("hinge", "animated");

                  }, 2000);  //Move these functions to another script to keep it from interfering with the Post requests.
            });
    </script>

</body>

</html>
